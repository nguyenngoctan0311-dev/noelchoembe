<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/noelchoembe/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Magic Hand - Select & Zoom</title>

    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
    
    <style>
      /* Style cho con tr·ªè ·∫£o */
      #virtual-cursor {
        position: fixed;
        width: 20px; height: 20px;
        background-color: rgba(255, 0, 0, 0.7); /* M√†u ƒë·ªè b√°n trong su·ªët */
        border: 2px solid white;
        border-radius: 50%;
        pointer-events: none; /* Quan tr·ªçng: ƒê·ªÉ con tr·ªè kh√¥ng ch·∫∑n s·ª± ki·ªán click */
        z-index: 10000;
        transform: translate(-50%, -50%);
        box-shadow: 0 0 10px red;
        display: none; /* ·∫®n m·∫∑c ƒë·ªãnh */
      }

      /* Khi ·∫£nh ƒë∆∞·ª£c ch·ªçn (Hover) s·∫Ω c√≥ vi·ªÅn s√°ng */
      .hovered-image {
        outline: 4px solid #FFFF00 !important; /* Vi·ªÅn v√†ng */
        box-shadow: 0 0 20px #FFFF00;
        transition: transform 0.1s ease-out;
      }
    </style>
    <script type="module" crossorigin src="/noelchoembe/assets/index-DeEbhwRf.js"></script>
    <link rel="stylesheet" crossorigin href="/noelchoembe/assets/index-DQ3P1g1z.css">
  </head>
  <body>
    <div id="root"></div>
    
    <video class="input_video" style="display:none"></video>
    
    <div id="virtual-cursor"></div>

    <div id="hand-status" style="position: fixed; bottom: 10px; left: 10px; z-index: 9999; 
         background: rgba(0,0,0,0.6); color: white; padding: 8px; border-radius: 6px; 
         font-family: sans-serif; font-size: 12px; pointer-events: none;">
      üì∑ ƒêang kh·ªüi ƒë·ªông...
    </div>


    <script>
      (function() {
        const cursor = document.getElementById('virtual-cursor');
        const statusDiv = document.getElementById('hand-status');
        const videoElement = document.querySelector('.input_video');
        
        let lastHoveredElement = null; // L∆∞u ph·∫ßn t·ª≠ ƒëang ƒë∆∞·ª£c ch·ªçn
        let currentScale = 1.0;        // M·ª©c zoom hi·ªán t·∫°i c·ªßa ph·∫ßn t·ª≠ ƒë√≥
        
        // C·∫•u h√¨nh
        const SENSITIVITY = 4.0; 

        function onResults(results) {
          if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
            cursor.style.display = "block";
            statusDiv.innerText = "üëâ Di chuy·ªÉn ng√≥n tr·ªè v√†o ·∫£nh ƒë·ªÉ ch·ªçn -> R·ªìi Zoom";
            
            const landmarks = results.multiHandLandmarks[0];
            const thumb = landmarks[4];       // Ng√≥n c√°i
            const indexFinger = landmarks[8]; // Ng√≥n tr·ªè (D√πng l√†m con tr·ªè chu·ªôt)

            // 1. T√çNH T·ªåA ƒê·ªò CON TR·ªé TR√äN M√ÄN H√åNH
            // MediaPipe tr·∫£ v·ªÅ t·ªça ƒë·ªô 0.0 -> 1.0. Ta nh√¢n v·ªõi chi·ªÅu r·ªông/cao m√†n h√¨nh
            // L∆∞u √Ω: Camera th∆∞·ªùng b·ªã ng∆∞·ª£c g∆∞∆°ng, n√™n X = 1 - x
            const screenX = (1 - indexFinger.x) * window.innerWidth;
            const screenY = indexFinger.y * window.innerHeight;

            // C·∫≠p nh·∫≠t v·ªã tr√≠ con tr·ªè ƒë·ªè
            cursor.style.left = `${screenX}px`;
            cursor.style.top = `${screenY}px`;

            // 2. T√åM PH·∫¶N T·ª¨ D∆Ø·ªöI NG√ìN TAY (HIT TEST)
            // L·∫•y ph·∫ßn t·ª≠ n·∫±m t·∫°i v·ªã tr√≠ (x, y)
            const elementUnderFinger = document.elementFromPoint(screenX, screenY);

            // Ki·ªÉm tra xem ƒë√≥ c√≥ ph·∫£i l√† ·∫£nh (IMG) ho·∫∑c khung ch·ª©a ·∫£nh (DIV class box-image) kh√¥ng
            // B·∫°n c√≥ th·ªÉ s·ª≠a ƒëi·ªÅu ki·ªán n√†y t√πy theo code React c·ªßa b·∫°n
            // V√≠ d·ª•: elementUnderFinger.tagName === 'IMG'
            let target = null;
            if (elementUnderFinger) {
                target = elementUnderFinger.closest('img') || elementUnderFinger.closest('.box-image');
            }

            // 3. X·ª¨ L√ù HIGHLIGHT (VI·ªÄN V√ÄNG)
            if (lastHoveredElement && lastHoveredElement !== target) {
                // N·∫øu d·ªùi tay kh·ªèi ·∫£nh c≈© -> Reset ·∫£nh c≈©
                lastHoveredElement.classList.remove('hovered-image');
                lastHoveredElement.style.transform = 'scale(1)'; // Reset zoom v·ªÅ 1
                currentScale = 1.0;
            }

            if (target) {
                // N·∫øu ƒëang tr·ªè v√†o ·∫£nh m·ªõi
                lastHoveredElement = target;
                target.classList.add('hovered-image');
                
                // 4. X·ª¨ L√ù ZOOM KHI ƒêANG CH·ªåN ·∫¢NH
                const distance = Math.sqrt(
                  Math.pow(thumb.x - indexFinger.x, 2) + 
                  Math.pow(thumb.y - indexFinger.y, 2)
                );

                // Logic Zoom: Scale = 1 + ƒë·ªô m·ªü ng√≥n tay
                // Kho·∫£ng c√°ch c∆° b·∫£n l√† ~0.05. Tr·ª´ ƒëi ƒë·ªÉ b·∫Øt ƒë·∫ßu t·ª´ 0
                let fingerOpen = (distance - 0.05) * SENSITIVITY;
                if (fingerOpen < 0) fingerOpen = 0; // Kh√¥ng cho zoom nh·ªè h∆°n g·ªëc

                let newScale = 1.0 + fingerOpen;
                
                // Gi·ªõi h·∫°n max zoom
                if (newScale > 3.0) newScale = 3.0;

                // Apply Zoom v√†o ch√≠nh b·ª©c ·∫£nh ƒë√≥
                target.style.transform = `scale(${newScale})`;
            } else {
                lastHoveredElement = null;
            }

          } else {
            cursor.style.display = "none";
            statusDiv.innerText = "‚úã Gi∆° tay l√™n Camera ƒë·ªÉ b·∫Øt ƒë·∫ßu";
          }
        }

        // Setup MediaPipe
        const hands = new Hands({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
        hands.setOptions({
          maxNumHands: 1,
          modelComplexity: 1,
          minDetectionConfidence: 0.5,
          minTrackingConfidence: 0.5
        });
        hands.onResults(onResults);

        const camera = new Camera(videoElement, {
          onFrame: async () => { await hands.send({image: videoElement}); },
          width: 640, height: 480
        });
        camera.start();
      })();
    </script>
  </body>
</html>