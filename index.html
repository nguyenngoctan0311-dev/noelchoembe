<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/noelchoembe/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Christmas Tree - Magic Hand Zoom</title>

    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
    <script type="module" crossorigin src="/noelchoembe/assets/index-DeEbhwRf.js"></script>
    <link rel="stylesheet" crossorigin href="/noelchoembe/assets/index-DQ3P1g1z.css">
  </head>
  <body>
    <div id="root"></div>
    
    <video class="input_video" style="display:none"></video>
    
    <div id="hand-status" style="position: fixed; bottom: 10px; left: 10px; z-index: 9999; 
         background: rgba(0,0,0,0.6); color: white; padding: 8px; border-radius: 6px; 
         font-family: sans-serif; font-size: 12px; pointer-events: none;">
      ğŸ“· Äang khá»Ÿi Ä‘á»™ng Camera...
    </div>


    <script>
      (function() {
        // --- Cáº¤U HÃŒNH ---
        // ChÃºng ta sáº½ zoom tháº» 'root' vÃ¬ toÃ n bá»™ web React náº±m trong Ä‘Ã³
        const targetElement = document.getElementById('root'); 
        const statusDiv = document.getElementById('hand-status');
        const videoElement = document.querySelector('.input_video');
        
        let currentScale = 1.0;
        const SENSITIVITY = 3.5; // Äá»™ nháº¡y (Sá»‘ cÃ ng lá»›n zoom cÃ ng nhanh)

        // HÃ m xá»­ lÃ½ káº¿t quáº£ nháº­n diá»‡n
        function onResults(results) {
          if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
            statusDiv.innerText = "ğŸ‘Œ ÄÃ£ nháº­n diá»‡n tay! Chá»¥m/Má»Ÿ Ä‘á»ƒ Zoom";
            statusDiv.style.color = "#4ade80"; // MÃ u xanh lÃ¡

            const landmarks = results.multiHandLandmarks[0];

            // Láº¥y tá»a Ä‘á»™ Ä‘áº§u ngÃ³n cÃ¡i (4) vÃ  Ä‘áº§u ngÃ³n trá» (8)
            const thumb = landmarks[4];
            const indexFinger = landmarks[8];

            // TÃ­nh khoáº£ng cÃ¡ch (Pythagoras)
            const distance = Math.sqrt(
              Math.pow(thumb.x - indexFinger.x, 2) + 
              Math.pow(thumb.y - indexFinger.y, 2)
            );

            // LOGIC ZOOM
            // Khoáº£ng cÃ¡ch thÆ°á»ng tá»« 0.02 (chá»¥m) Ä‘áº¿n 0.25 (má»Ÿ)
            // CÃ´ng thá»©c map khoáº£ng cÃ¡ch sang scale
            let targetScale = 1 + (distance * SENSITIVITY);

            // Náº¿u chá»¥m quÃ¡ gáº§n (< 0.05), reset vá» kÃ­ch thÆ°á»›c gá»‘c
            if (distance < 0.05) targetScale = 1.0;

            // Giá»›i háº¡n Zoom (Min 1x, Max 3x)
            if (targetScale < 1.0) targetScale = 1.0;
            if (targetScale > 3.0) targetScale = 3.0;

            // LÃ m mÆ°á»£t chuyá»ƒn Ä‘á»™ng (Lerp)
            currentScale = currentScale + (targetScale - currentScale) * 0.1;

            // Ãp dá»¥ng CSS vÃ o React Root
            if (targetElement) {
              targetElement.style.transition = "transform 0.05s ease-out";
              targetElement.style.transformOrigin = "center center";
              targetElement.style.transform = `scale(${currentScale})`;
            }

          } else {
            statusDiv.innerText = "âœ‹ GiÆ¡ tay lÃªn Camera Ä‘á»ƒ Ä‘iá»u khiá»ƒn";
            statusDiv.style.color = "white";
          }
        }

        // Khá»Ÿi táº¡o MediaPipe
        const hands = new Hands({locateFile: (file) => {
          return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
        }});

        hands.setOptions({
          maxNumHands: 1,
          modelComplexity: 1,
          minDetectionConfidence: 0.5,
          minTrackingConfidence: 0.5
        });

        hands.onResults(onResults);

        // Khá»Ÿi Ä‘á»™ng Camera
        const camera = new Camera(videoElement, {
          onFrame: async () => {
            await hands.send({image: videoElement});
          },
          width: 640,
          height: 480
        });
        
        camera.start().then(() => {
             console.log("Camera started");
        }).catch(err => {
             statusDiv.innerText = "Lá»—i Camera: " + err;
        });

      })();
    </script>
  </body>
</html>